[submission]
bindir = "/home/snh02/pack/48t3_fix.04.OMPIIFC2104.x/bin"
default_submit_type = "serial"
lfftw = true
module_initpath = "/software/sse2/init/"
nproma = -32

submit_types = ["serial", "parallel"]

[submission.parallel]
  NPROC = 32
  SCHOST = "nebula"
  tasks = ["Forecast", "e927", "Pgd", "Prep", "c903"]
  WRAPPER = "mpprun"

[submission.parallel.BATCH]
  NAME = "#SBATCH --job-name=@TASK_NAME@"
  WALLTIME = "#SBATCH --time=00:10:00"

[submission.parallel.ENV]
  DR_HOOK = 1
  DR_HOOK_IGNORE_SIGNALS = -1
  OMP_NUM_THREADS = 1
  OMPI_MCA_btl = "^vader"

[submission.parallel.MODULES]
  00_MET_MODULES = ["load", "met-modules_el9"]
  01_ECFLOW = ["load", "ecflow/5.12.3"]

[submission.serial]
  NPROC = 1
  NPROCX = 1
  NPROCY = 1
  SCHOST = "nebula"
  tasks = ["CreateGrib", "Gmted", "Soil", "Marsprep"]
  WRAPPER = "mpprun"

[submission.serial.BATCH]
  NAME = "#SBATCH --job-name=@TASK_NAME@"
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=1"
  WALLTIME = "#SBATCH --time=00:30:00"

[submission.serial.ENV]
  DR_HOOK_IGNORE_SIGNALS = -1
  OMP_NUM_THREADS = 1
  OMPI_MCA_btl = "^vader"
  FC="mpiifort"
  CC="icc"

[submission.serial.MODULES]
  00_MET_MODULES = ["load", "met-modules_el9"]
  01_ECFLOW = ["load", "ecflow/5.12.3"]

[submission.task]
  wrapper = ""

[submission.task_exceptions.CMakeBuild.MODULES]
  02_INTEL = ["load", "buildenv-intel/2023a-eb"]
  03_CMAKE = ["load", "CMake/3.27.9"]
  04_NETCDF = ["load", "netCDF-HDF5/4.9.2-1.12.2-hpc1"]
  05_HD5 = ["load", "HDF5/1.12.2-hpc1"]
  #06_ECCODES = ["load", "eccodes/2.32.0-ENABLE-AEC-hpc1"]

[submission.task_exceptions.ArchiveHour.BATCH]
  WALLTIME = "#SBATCH --time=03:00:00"

[submission.task_exceptions.ArchiveStatic.BATCH]
  WALLTIME = "#SBATCH --time=03:00:00"

[submission.task_exceptions.c903]
  NPROC = 36

[submission.task_exceptions.c903.BATCH]
  MEM = "#SBATCH --mem=200GB"
  NODE = "#SBATCH --nodes=12"
  NTASKS = "#SBATCH --ntasks=36"
  WALLTIME = "#SBATCH --time=00:30:00"

[submission.task_exceptions.creategrib]
  binary = "gl_20230823"
  bindir = "/home/snh02/work/gl_binaries"

[submission.task_exceptions.CreateGrib.BATCH]
  WALLTIME = "#SBATCH --time=01:00:00"

[submission.task_exceptions.e927]
  NPROC = 16

[submission.task_exceptions.e927.BATCH]
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=16"

[submission.task_exceptions.Forecast]
  NPROC = 256

[submission.task_exceptions.Forecast.BATCH]
  MEM = "#SBATCH --mem=200GB"
  NODES = "#SBATCH --nodes=2"
  NTASKS = "#SBATCH --ntasks=256"
  WALLTIME = "#SBATCH --time=01:00:00"

[submission.task_exceptions.Forecast.ENV]
  RTTOV_COEFDIR = "/hpcperm/snh02/DEODE/satellite/rtcoef_rttov12/harm_coef/"
  UCX_LOG_LEVEL = "error"

[submission.task_exceptions.Gmted.MODULES]
  GDAL = ["load", "GDAL/3.5.0-hpc1-gcc-2022a-eb"]

[submission.task_exceptions.Marsprep.BATCH]
  MEM = "#SBATCH --mem=0GB"
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=1"
  QOS = "#SBATCH --qos=np"
  WALLTIME = "#SBATCH --time=01:00:00"

[submission.task_exceptions.Marsprep.ENV]
  MARS_READANY_BUFFER_SIZE = 17893020000

[submission.task_exceptions.Pgd]
  WRAPPER = "srun -n @NPROC@"

[submission.task_exceptions.Pgd.BATCH]
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=2"
  WALLTIME = "#SBATCH --time=00:30:00"

[submission.task_exceptions.PgdUpdate]
  binary = "gl_20230823"
  bindir = "/home/snh02/work/gl_binaries"

[submission.task_exceptions.Prep]
  WRAPPER = "srun -n @NPROC@"

[submission.task_exceptions.Prep.BATCH]
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=1"
  WALLTIME = "#SBATCH --time=00:10:00"

[submission.task_exceptions.Soil.MODULES]
  GDAL = ["load", "GDAL/3.5.0-hpc1-gcc-2022a-eb"]

