
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>surfExp documentation &#8212; surfExp  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="#">surfExp  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">surfExp documentation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="surfexp-documentation">
<h1>surfExp documentation<a class="headerlink" href="#surfexp-documentation" title="Permalink to this heading">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<img alt="https://coveralls.io/repos/github/metno/surfExp/badge.svg?branch=master" id="readme" src="https://coveralls.io/repos/github/metno/surfExp/badge.svg?branch=master" />
<p><a class="reference external" href="https://coveralls.io/github/metno/surfExp">https://coveralls.io/github/metno/surfExp</a></p>
</section>
<section id="this-repository-is-a-setup-to-create-and-run-offline-surfex-experiments">
<h1>This repository is a setup to create and run offline SURFEX experiments.<a class="headerlink" href="#this-repository-is-a-setup-to-create-and-run-offline-surfex-experiments" title="Permalink to this heading">¶</a></h1>
<p>See online documentation in <a class="reference external" href="https://metno.github.io/surfExp/">https://metno.github.io/surfExp/</a>
The setup is dependent of pysurfex (<a class="reference external" href="https://metno.github.io/pysurfex">https://metno.github.io/pysurfex</a>) and deode workflow (<a class="reference external" href="https://github.com/destination-earth-digital-twins/Deode-Workflow">https://github.com/destination-earth-digital-twins/Deode-Workflow</a> / <a class="reference external" href="https://github.com/trygveasp/Deode-Workflow">https://github.com/trygveasp/Deode-Workflow</a>)</p>
<p>You need a python3 parser and the following dependencies are needed. Install the non-standard ones e.g. with pip or your system installation system. Requirements can be found in <a class="reference external" href="https://github.com/metno/surfExp/blob/master/requirements.txt">https://github.com/metno/surfExp/blob/master/requirements.txt</a></p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h2>
<p>The recommended installation method is using poetry. First install poetry. This can be done in several ways like a system package or ftom pypi. The recommended way is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-sSL<span class="w"> </span>https://install.python-poetry.org<span class="w"> </span><span class="p">|</span><span class="w"> </span>python3<span class="w"> </span>-
</pre></div>
</div>
<p>When you have poetry installed make sure you have it in path. It might be installed in ~/.local/bin.
To install the script system first clone <a class="reference external" href="https://github.com/metno/surfExp">https://github.com/metno/surfExp</a> and install it.
To run commands interactively in the poetry environment you need to run either “poetry shell” or “poetry run [cmd]”</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>projects
<span class="nb">cd</span><span class="w"> </span>projects

<span class="c1"># Clone the source code</span>
clone<span class="w"> </span>https://github.com/metno/surfExp

<span class="c1"># Install the script system</span>
<span class="nb">cd</span><span class="w"> </span>surfExp
poetry<span class="w"> </span>install

<span class="c1"># Enter the environment</span>
poetry<span class="w"> </span>shell
</pre></div>
</div>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p>The altering of the configuration must then be done by applying a defined configuration or a configuration file with patches from original configuration. Examples are local configurations, domains etc.
In addition you will get some other config files used in the tasks. An example on how to use it inside a poetry environment (“poetry shell”)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># First make sure you are in a poetry environment after executing &quot;poetry shell&quot;</span>
<span class="nb">cd</span><span class="w"> </span>~/projects/surfExp
poetry<span class="w"> </span>shell

<span class="c1"># Alternative way of setting up a pre-defined SEKF configuration</span>
surfExp<span class="w"> </span>my_config.toml<span class="w"> </span>SEKF<span class="w"> </span>surfexp/data/config<span class="w"> </span>data/config/configurations/sekf.toml

<span class="c1"># Use AROME Arctic branch on PPI together with MET-Norway LDAS</span>
surfExp<span class="w"> </span>my_config.toml<span class="w"> </span>LDAS<span class="w"> </span>surfexp/data/config/configurations/metno_ldas.toml<span class="w"> </span>surfexp/data/config/mods/arome_arctic_offline_ppi.toml

<span class="c1"># To start you experiment</span>
deode<span class="w"> </span>start<span class="w"> </span>suite<span class="w"> </span>--config-file<span class="w"> </span>my_config.toml
</pre></div>
</div>
<p>Here is an example with CARRA2 using poetry run.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/projects/surfExp

<span class="c1"># Create experiment in file data/config/CARRA2_MINI.toml</span>
poetry<span class="w"> </span>run<span class="w"> </span>surfExp<span class="w"> </span>CARRA2_MINI.toml<span class="w"> </span>CARRA2-MINI<span class="w"> </span>surfexp/data/config/configurations/carra2.toml

<span class="c1"># Modify times in data/config/CARRA2_MINI.toml</span>
<span class="c1"># Run experiment from config file data/config/CARRA2_MINI.toml</span>
poetry<span class="w"> </span>run<span class="w"> </span>deode<span class="w"> </span>start<span class="w"> </span>suite<span class="w"> </span>--config-file<span class="w"> </span>data/config/CARRA2_MINI.toml
</pre></div>
</div>
</section>
<section id="extra-environment-on-ppi-rhel8-needed-to-start-experiments">
<h2>Extra environment on PPI-RHEL8 needed to start experiments<a class="headerlink" href="#extra-environment-on-ppi-rhel8-needed-to-start-experiments" title="Permalink to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ib-dev queue is only in A: ib-dev-a-r8.q</span>
ssh<span class="w"> </span>ppi-r8login-a1.int.met.no

<span class="c1"># Get surfExp</span>
git<span class="w"> </span>clone<span class="w"> </span>github.com:trygveasp/surfExp.git<span class="w">  </span>--branch<span class="w"> </span>feature/deode_offline_surfex<span class="w"> </span>surfExp

<span class="c1"># conda setup</span>
<span class="nb">source</span><span class="w"> </span>/modules/rhel8/user-apps/suv-modules/miniconda3/24.7.1/etc/profile.d/conda.sh
conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>surfExp<span class="w"> </span><span class="nv">python</span><span class="o">==</span><span class="m">3</span>.10<span class="w"> </span>-y
conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>-n<span class="w"> </span>surfExp<span class="w"> </span>poetry<span class="w"> </span>gdal<span class="w"> </span>-y
conda<span class="w"> </span>activate<span class="w"> </span>surfExp

<span class="c1"># Install</span>
poetry<span class="w"> </span>install

<span class="c1"># MET-Norway LDAS experiment</span>
mkdir<span class="w"> </span>-f<span class="w"> </span>exps
surfExp<span class="w"> </span>exps/LDAS.toml<span class="w"> </span>LDAS<span class="w"> </span><span class="nv">$PWD</span>/data/config/configurations/metno_ldas.toml<span class="w"> </span><span class="nv">$PWD</span>/data/config/domains/MET_NORDIC_1_0.toml<span class="w"> </span><span class="nv">$PWD</span>/data/config/mods/arome_arctic_offline_ppi.toml<span class="w"> </span><span class="nv">$PWD</span>/data/config/mods/netcdf_input_pgd.toml<span class="w"> </span><span class="nv">$PWD</span>/data/config/scheduler/ecflow_ppi_rhel8-<span class="nv">$USER</span>.toml

<span class="c1"># PPI ECFLOW (in A)</span>
<span class="c1"># If your server is not running you should start it!</span>
module<span class="w"> </span>use<span class="w"> </span>/modules/MET/rhel8/user-modules/
module<span class="w"> </span>load<span class="w"> </span>ecflow/5.8.1
<span class="nb">export</span><span class="w"> </span><span class="nv">ECF_SSL</span><span class="o">=</span><span class="m">1</span>

<span class="c1"># Start suite (modify dates)</span>
deode<span class="w"> </span>start<span class="w"> </span>suite<span class="w"> </span>--config-file<span class="w"> </span>exps/LDAS.toml


<span class="c1"># MET-Norway LDAS single decade</span>
surfExp<span class="w"> </span>exps/LDAS_decade.toml<span class="w"> </span>LDAS_decade<span class="w"> </span><span class="nv">$PWD</span>/data/config/configurations/metno_ldas.toml<span class="w"> </span><span class="nv">$PWD</span>/data/config/domains/MET_NORDIC_1_0.toml<span class="w"> </span><span class="nv">$PWD</span>/data/config/mods/arome_arctic_offline_ppi.toml<span class="w"> </span><span class="nv">$PWD</span>/data/config/mods/netcdf_input_pgd.toml<span class="w"> </span><span class="nv">$PWD</span>/data/config/mods/netcdf_input_single_decade.toml<span class="w"> </span><span class="nv">$PWD</span>/data/config/mods/metno_ldas_single_decade.toml<span class="w"> </span><span class="nv">$PWD</span>/data/config/scheduler/ecflow_ppi_rhel8-<span class="nv">$USER</span>.toml
deode<span class="w"> </span>start<span class="w"> </span>suite<span class="w">  </span>--config-file<span class="w"> </span>exps/LDAS_decade.toml
</pre></div>
</div>
</section>
<section id="trainings">
<h2>Trainings<a class="headerlink" href="#trainings" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/metno/surfExp/blob/master/trainings/budapest_may_2022.rst/">Budapest May 2022</a> (Old version)</p>
</section>
<section id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this heading">¶</a></h2>
</section>
<section id="class-methods">
<h2>Class methods<a class="headerlink" href="#class-methods" title="Permalink to this heading">¶</a></h2>
</section>
<section id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><dl class="field-list simple">
<dt class="field-odd">ref<span class="colon">:</span></dt>
<dd class="field-odd"><p><cite>README</cite></p>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="#">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">surfExp documentation</a></li>
<li><a class="reference internal" href="#this-repository-is-a-setup-to-create-and-run-offline-surfex-experiments">This repository is a setup to create and run offline SURFEX experiments.</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
<li><a class="reference internal" href="#extra-environment-on-ppi-rhel8-needed-to-start-experiments">Extra environment on PPI-RHEL8 needed to start experiments</a></li>
<li><a class="reference internal" href="#trainings">Trainings</a></li>
<li><a class="reference internal" href="#classes">Classes</a></li>
<li><a class="reference internal" href="#class-methods">Class methods</a></li>
<li><a class="reference internal" href="#methods">Methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="#">surfExp  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">surfExp documentation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Trygve Aspelien.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    </div>
  </body>
</html>